package ru.kpfu.itis.service;

import ru.kpfu.itis.model.GameMap;
import ru.kpfu.itis.model.Hex;
import ru.kpfu.itis.enums.Type;

public class MapFactory {

    /**
     * КАРТА 1: БОЛЬШОЙ МАТЕРИК С ПОЛУОСТРОВАМИ
     */
    public static GameMap createPeninsulaMap() {
        GameMap map = new GameMap(20, 19);
        int[][] peninsula = new int[][]{
                {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0},
                {0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0},
                {0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0},
                {0, 0, 0, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0},
                {0, 0, 0, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0},
                {0, 0, 0, 1, 1, 1, 0, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 0},
                {0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1, 0},
                {0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0},
                {0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0},
                {0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0},
                {0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0},
                {0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0},
                {0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}
        };
        placeHexesFromMap(map, peninsula);
        setStartingZones(map,
                new int[][]{{5, 4}, {5, 5}, {6, 4}, {6, 5}, {6, 6}},
                new int[][]{{13, 12}, {13, 13}, {12, 13}, {12, 12}, {13, 11}},
                new int[][]{{5, 13}, {5, 14}, {6, 13}, {6, 14}, {6, 15}},
                new int[][]{{13, 4}, {13, 5}, {12, 4}, {12, 5}, {13, 6}});
        return map;
    }

    /**
     * КАРТА 2: S-ОБРАЗНЫЙ КОНТИНЕНТ
     */
    public static GameMap createSShapedMap() {
        GameMap map = new GameMap(20, 19);
        int[][] sShaped = new int[][]{
                {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0},
                {0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0},
                {0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0},
                {0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
                {0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1},
                {0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0},
                {0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0},
                {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0},
                {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}
        };
        placeHexesFromMap(map, sShaped);
        setStartingZones(map, 
                new int[][]{{5, 4}, {6, 4}, {5, 5}, {6, 5}, {5, 6}},
                new int[][]{{14, 11}, {15, 11}, {14, 10}, {15, 10}, {13, 10}},
                new int[][]{{5, 13}, {6, 13}, {5, 14}, {6, 14}, {5, 15}},
                new int[][]{{14, 4}, {15, 4}, {14, 5}, {15, 5}, {13, 5}});
        return map;
    }

    /**
     * КАРТА 3: ЗВЁЗДООБРАЗНЫЙ МАТЕРИК
     */
    public static GameMap createStarShapedMap() {
        GameMap map = new GameMap(20, 19);
        int[][] star = new int[][]{
                {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0},
                {0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0},
                {0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0},
                {0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0},
                {0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0},
                {0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}
        };
        placeHexesFromMap(map, star);
        setStartingZones(map, 
                new int[][]{{4, 7}, {5, 6}, {4, 6}, {5, 7}, {5, 8}},
                new int[][]{{14, 7}, {13, 8}, {14, 8}, {13, 7}, {13, 6}},
                new int[][]{{9, 3}, {9, 4}, {8, 4}, {10, 4}, {9, 5}},
                new int[][]{{9, 11}, {9, 12}, {8, 12}, {10, 12}, {9, 13}});
        return map;
    }

    /**
     * КАРТА 4: Т-ОБРАЗНЫЙ МАТЕРИК
     */
    public static GameMap createTShapedMap() {
        GameMap map = new GameMap(20, 19);
        int[][] tShaped = new int[][]{
                {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0},
                {0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0},
                {0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0},
                {0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0},
                {0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0},
                {0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0},
                {0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}
        };
        placeHexesFromMap(map, tShaped);
        setStartingZones(map, 
                new int[][]{{5, 4}, {5, 5}, {6, 4}, {4, 4}, {6, 5}},
                new int[][]{{14, 14}, {14, 15}, {13, 14}, {15, 14}, {13, 15}},
                new int[][]{{5, 13}, {5, 14}, {6, 13}, {4, 13}, {6, 14}},
                new int[][]{{14, 4}, {14, 5}, {13, 4}, {15, 4}, {13, 5}});
        return map;
    }

    /**
     * КАРТА 5: С-ОБРАЗНЫЙ МАТЕРИК
     */
    public static GameMap createCShapedMap() {
        GameMap map = new GameMap(20, 19);
        int[][] cShaped = new int[][]{
                {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0},
                {0, 0, 0, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0},
                {0, 0, 0, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0},
                {0, 0, 0, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0},
                {0, 0, 0, 1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0},
                {0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0},
                {0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0},
                {0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0}
        };
        placeHexesFromMap(map, cShaped);
        setStartingZones(map, 
                new int[][]{{4, 4}, {5, 4}, {4, 5}, {5, 5}, {4, 6}},
                new int[][]{{14, 11}, {14, 12}, {13, 11}, {13, 12}, {14, 10}},
                new int[][]{{4, 13}, {5, 13}, {4, 14}, {5, 14}, {4, 15}},
                new int[][]{{14, 4}, {14, 5}, {13, 4}, {13, 5}, {14, 6}});
        return map;
    }

    /**
     * Размещение гексов по карте из шаблона (с водой по периметру)
     * 1 = гекс (трава), 0 = пусто (вода/null)
     */
    private static void placeHexesFromMap(GameMap map, int[][] pattern) {
        for (int y = 0; y < pattern.length && y < map.getHeight(); y++) {
            for (int x = 0; x < pattern[y].length && x < map.getWidth(); x++) {
                if (pattern[y][x] == 1) {
                    // Создаём новый гекс (Трава)
                    Hex hex = new Hex(x, y, Type.GRASS);
                    map.getGrid().get(y).set(x, hex);
                } else {
                    // Если 0, то гекса быть НЕ должно -> null (вода)
                    map.getGrid().get(y).set(x, null);
                }
            }
        }
    }

    /**
     * Установка стартовых зон для четырех игроков
     * @param map Карта игры
     * @param player0Positions Стартовые позиции для Player 0 (RED)
     * @param player1Positions Стартовые позиции для Player 1 (BLUE)
     * @param player2Positions Стартовые позиции для Player 2 (GREEN)
     * @param player3Positions Стартовые позиции для Player 3 (YELLOW)
     */
    private static void setStartingZones(GameMap map, int[][] player0Positions, int[][] player1Positions, 
                                         int[][] player2Positions, int[][] player3Positions) {
        // Player 0 (RED) - ID = 0
        for (int i = 0; i < player0Positions.length; i++) {
            int x = player0Positions[i][0];
            int y = player0Positions[i][1];
            Hex hex = map.getHex(x, y);
            if (hex != null) {
                hex.setOwnerId(0);
                if (i == 0) { // Первая позиция - столица
                    hex.setCapital(true);
                }
            }
        }
        // Player 1 (BLUE) - ID = 1
        for (int i = 0; i < player1Positions.length; i++) {
            int x = player1Positions[i][0];
            int y = player1Positions[i][1];
            Hex hex = map.getHex(x, y);
            if (hex != null) {
                hex.setOwnerId(1);
                if (i == 0) { // Первая позиция - столица
                    hex.setCapital(true);
                }
            }
        }
        // Player 2 (GREEN) - ID = 2
        for (int i = 0; i < player2Positions.length; i++) {
            int x = player2Positions[i][0];
            int y = player2Positions[i][1];
            Hex hex = map.getHex(x, y);
            if (hex != null) {
                hex.setOwnerId(2);
                if (i == 0) { // Первая позиция - столица
                    hex.setCapital(true);
                }
            }
        }
        // Player 3 (YELLOW) - ID = 3
        for (int i = 0; i < player3Positions.length; i++) {
            int x = player3Positions[i][0];
            int y = player3Positions[i][1];
            Hex hex = map.getHex(x, y);
            if (hex != null) {
                hex.setOwnerId(3);
                if (i == 0) { // Первая позиция - столица
                    hex.setCapital(true);
                }
            }
        }
    }

    public static GameMap getMapById(int mapId) {
        return switch (mapId) {
            case 0 -> createPeninsulaMap();
            case 1 -> createSShapedMap();
            case 2 -> createStarShapedMap();
            case 3 -> createTShapedMap();
            case 4 -> createCShapedMap();
            default -> createPeninsulaMap();
        };
    }

    public static String getMapNameById(int mapId) {
        return switch (mapId) {
            case 0 -> "Материк с полуостровами";
            case 1 -> "S-образный континент";
            case 2 -> "Звёздообразный материк";
            case 3 -> "Т-образный материк";
            case 4 -> "С-образный материк";
            default -> "Неизвестная карта";
        };
    }

    public static String getMapDescriptionById(int mapId) {
        return switch (mapId) {
            case 0 -> "Единый континент с множеством полуостровов - контроль полуостровов даёт стратегическое преимущество";
            case 1 -> "Волнистый континент в форме буквы S - движение и экспансия в одном направлении";
            case 2 -> "Звёзда с пятью лучами из центра - контроль центра даёт доступ ко всем направлениям";
            case 3 -> "Две большие области, связанные узким проливом - битва за стратегический проход";
            case 4 -> "C-образный материк, как Индия - контроль побережья и внутренних регионов";
            default -> "Описание недоступно";
        };
    }

    public static GameMap[] getAllMaps() {
        return new GameMap[]{
                createPeninsulaMap(),
                createSShapedMap(),
                createStarShapedMap(),
                createTShapedMap(),
                createCShapedMap()
        };
    }

    public static GameMap getRandomMap() {
        int randomId = (int)(Math.random() * 5);
        return getMapById(randomId);
    }
}
